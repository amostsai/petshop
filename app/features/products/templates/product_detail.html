{% extends "base.html" %}
{% block content %}
<div class="mb-6">
    <a href="{{ url_for('products.catalog') }}" class="text-pink-500 hover:text-pink-700 text-sm font-semibold">
        ← 返回商品專區
    </a>
</div>

<div class="bg-white rounded-2xl shadow-lg overflow-hidden">
    <div class="grid grid-cols-1 lg:grid-cols-2">
        <div class="bg-pink-50 flex items-center justify-center p-6">
            <img src="{{ primary_image }}" alt="{{ product.name }}" class="max-h-96 object-contain rounded-lg shadow">
        </div>
        <div class="p-6 lg:p-10 flex flex-col gap-4">
            <span class="inline-flex items-center text-xs font-semibold text-pink-600 bg-pink-100 px-3 py-1 rounded-full w-max">
                {{ product.category_name }}
            </span>
            <h1 class="text-3xl font-extrabold text-pink-700">{{ product.name }}</h1>
            <div class="text-2xl font-semibold text-gray-800">
                {{ ('NT$ {:,.0f}').format(product.price) }}
            </div>
            <div class="text-sm">
                <span class="font-semibold {{ 'text-green-600' if in_stock else 'text-gray-400' }}">
                    {% if in_stock %}
                        現貨 {{ product.stock }} 件
                    {% else %}
                        暫時缺貨
                    {% endif %}
                </span>
            </div>
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">{{ product.description }}</p>

            {% if images|length > 1 %}
            <div>
                <h2 class="text-sm font-semibold text-gray-500 mb-2">其他商品圖片</h2>
                <div class="flex gap-3">
                    {% for image in images %}
                    <img src="{{ image.image_url }}"
                         class="w-16 h-16 object-cover rounded border {{ 'border-pink-400' if image.is_primary else 'border-gray-200' }}"
                         alt="{{ product.name }} 圖片 {{ loop.index }}">
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <form method="post" action="{{ url_for('cart.add_item') }}" class="mt-4">
                <input type="hidden" name="product_slug" value="{{ product.slug }}">
                <div class="flex items-center gap-4">
                    <label class="text-sm font-semibold text-gray-600" for="quantity">數量</label>
                    <input type="number" id="quantity" name="quantity" min="1" value="1"
                           class="w-20 px-3 py-2 border border-pink-200 rounded focus:outline-none focus:ring-2 focus:ring-pink-400">
                </div>
                <button type="submit"
                        class="mt-4 inline-flex items-center justify-center px-6 py-3 text-white font-semibold rounded-lg shadow {{ 'bg-pink-500 hover:bg-pink-600' if in_stock else 'bg-gray-300 cursor-not-allowed' }}"
                        {% if not in_stock %}disabled{% endif %}>
                    <i class="fa-solid fa-cart-plus mr-2"></i>
                    {% if in_stock %}加入購物車{% else %}缺貨中{% endif %}
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
